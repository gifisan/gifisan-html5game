// Licensed under the BoxBoot License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// 
// ┌────────────────────────────────────────────────────────────┐ \\
// │ Test1 1.02 - JavaScript canvas Library                     │ \\
// ├────────────────────────────────────────────────────────────┤ \\
// │ Author boxboot (http://www.boxboot.com/)                   │ \\
// └────────────────────────────────────────────────────────────┘ \\
// 
// Copyright (c) 2013 BoxBoot Systems Incorporated. All rights reserved.
//
(function(Game){Game=window.Game=Game||window.Game||new function(){},Game.math=Game.math||new function(){},window.$gm=Game.math,Game.version=Game.version||"1.02";var check=function(e){return e.test(navigator.userAgent.toLowerCase())};Game.isIE=!check(/opera/)&&check(/msie/),Game.genId=Game.genId||1e3,Game.ui=Game.ui||new function(){},Game.util=Game.util||new function(){},Game.classes=Game.classes||new function(){},Game.comps=Game.comps||new function(){},Game.Object=Game.Object||function(){this.className="Game.Object"},Game.apply=function(e,t,n){if(e&&t){var r={toString:!0},i=typeof e=="function"?e.prototype:e,s=typeof t=="function"?t.prototype:t;if(n){for(var o in s)if(r[o]||!n[o])i[o]=s[o]}else for(var o in s)i[o]=s[o]}return e},Game.apply(Game,{reg:function(e,t){this.classes[e]&&this.warn("Class repeat:"+e),this.classes[e]=t,t.prototype.xtype=e},namespace:function(name){var parts=name.split("."),container=window;container[parts[0]]||eval("var "+parts[0]+" = "+parts[0]+" || new function(){};window."+parts[0]+"="+parts[0]);for(var i=0;i<parts.length;i++){var part=parts[i];if(!container[part])eval(parts.slice(0,i+1).join(".")+"="+parts.slice(0,i+1).join(".")+"|| new function(){}");else if(typeof container[part]!="object"){var n=parts.slice(0,i).join(".");throw n+" already exists and is not an object"}container=container[part]}return container},create:function(e,t){var n=new this.classes[e];if(t)for(var r in t)n[r]=t[r];if(!n.id){var i=this.getId(e);n.id=i}return this.comps[n.id],this.comps[n.id]=n,n.init&&n.init(),n},log:function(e){console.log(e)},warn:function(e){console.warn(e)},error:function(e){console.error(e)},getId:function(e){return e+"-gen-"+this.genId++},get:function(e){var t=document.getElementById(e);return t?t:this.comps[e]},getCmp:function(e){return this.comps[e]},onReady:function(e){window.onload=e},copy:function(e){if(e.className)return Game.create(e.xtype);if(this.isObject(e)){var t={};for(var n in e)t[n]=this.copy(e[n]);return t}if(this.isArray(e)){t=[];for(var n in e)t[n]=this.copy(e[n]);return t}return e},createRect:function(e,t,n){var r=[];for(var i=0;i<t;i++){r[i]=[];for(var s=0;s<e;s++)r[i][s]=n}return r}}),Game.apply(Game,{applyIf:function(e,t){if(t&&e){var n={xtype:!0,init:!0},r=typeof e=="function"?e.prototype:e,i=typeof t=="function"?t.prototype:t;for(var s in i)!n[s]&&r[s]==null&&(r[s]=i[s])}},isObject:function(e){return Array.isArray(e)?!1:typeof e=="object"},isArray:function(e){return Array.isArray(e)},isNull:function(e){return e==null||e==undefined}}),Game.apply(Game,{extend:function(e,t){if(t==null)return this.extend(this.Object,e);if(!this.isObject(t))throw new Error("son is not a object.");var n=function(){e.apply(this,arguments);for(var n in t){var r=t[n];typeof r!="function"&&n!="xtype"&&(this[n]=Game.copy(r))}},r=n.prototype=Game.copy(e.prototype);for(var i in t){var s=t[i];typeof s=="function"&&(r[i]=s)}return r.superClass=e,n},override:function(e,t){if(t){var n=e.prototype;Game.apply(n,t),Game.isIE&&t.toString!=e.toString&&(n.toString=t.toString)}}}),Game.apply(Game.Object,{superCall:function(e,t,n){var r=t[e],i=t.superClass.prototype[e];_o=t.superClass.prototype.superClass;while(i==r)i=_o.prototype[e],_o=_o.prototype.superClass;i.apply(t,n)},toString:function(){return(this.className?this.className:this.xtype)+"@"+this.id},onDestroy:function(){},init:function(){},onInit:function(){},beforeInit:function(){},destroy:function(){delete Game.comps[this.id],this.onDestroy()}}),Game.apply(Game.math,{pos:function(e,t,n){var r=e/t,i=parseInt(r),s=r-i;return n!=null&&s>n?-1:i},rotate:function(e,t){var n=Math.sqrt(e*e+t*t);return e>=0&&t>=0?Math.asin(e/n):e>=0&&t<=0?Math.acos(e/n)+Math.PI/2:e<=0&&t<=0?Math.asin(-e/n)+Math.PI:e<=0&&t>=0?Math.acos(-e/n)+Math.PI*3/2:0},distance:function(e,t,n,r){var i=n-e,s=r-t;return Math.sqrt(i*i+s*s)}}),Game.namespace("Game.math.AStar"),Game.apply(Game.math.AStar,{COST_STRAIGHT:10,COST_DIAGONAL:14,NODE_NOWAY:0,NODE_NONE:0,NODE_OPEN:1,NODE_CLOSED:2,map:null,mapc:null,width:0,height:0,OpenList:null,olength:0,findFalg:!1,OpenTable:{},className:"Game.math.AStar",reset:function(e,t,n,r,i){this.sx=e,this.sy=t,this.height=r,this.width=n,this.map=this.copyMapArea(e,t,n,r,i),this.mapc?this.resetMapc(this.NODE_NONE):this.mapc=Game.createRect(this.width,this.height,this.NODE_NONE),this.OpenList=[this.width*this.height/2],this.findFalg=!1,this.OpenTable={},this.olength=0},resetMapc:function(e){for(var t in this.mapc){var n=this.mapc[t];for(var r in n)n[r]=e}},copyMapArea:function(e,t,n,r,i){var s=[],o,u;i.length-e>r?(o=e,r=e+r):(o=i.length-r,r=i.lenght),i[0].length-t>n?(u=t,n=t+n):(u=i[0].length-n,n=i[0].lenght);var a=0,f=u;for(;o<r;o++){var l=s[a++]=[],c=0;for(;u<n;u++)l[c++]=i[o][u];u=f}return s},createNode:function(e,t,n,r){return{x:e,y:t,f:0,g:0,h:0,map:n,parent:r}},find:function(e,t,n,r){var i=this.createNode(e,t),s=this.createNode(n,r);this.olength++,this.OpenList[this.olength]=i,this.mapc[i.x][i.y]=this.NODE_OPEN;var o=null;while(this.olength>0){o=this.OpenList[1];var u=this.check(o.x,o.y+1,s,o,this.COST_STRAIGHT),a=this.check(o.x+1,o.y,s,o,this.COST_STRAIGHT),f=this.check(o.x,o.y-1,s,o,this.COST_STRAIGHT),l=this.check(o.x-1,o.y,s,o,this.COST_STRAIGHT);this.check(o.x+1,o.y+1,s,o,this.COST_DIAGONAL),this.check(o.x-1,o.y+1,s,o,this.COST_DIAGONAL),this.check(o.x+1,o.y-1,s,o,this.COST_DIAGONAL),this.check(o.x-1,o.y-1,s,o,this.COST_DIAGONAL),this.putClosedTabe(o,s);if(this.findFalg)break}if(this.findFalg){var c=[];return this.read(c,o),c}return null},read:function(e,t){t.parent!=null&&this.read(e,t.parent),e.push(t)},check:function(e,t,n,r,i){return e<0||e==this.height||t<0||t==this.width?!1:this.map[e][t]==this.NODE_NOWAY?!1:this.mapc[e][t]==this.NODE_CLOSED?!1:this.mapc[e][t]==this.NODE_NONE?(this.putOpenTable(e,t,n,r,i),this.mapc[e][t]=this.NODE_OPEN,!0):this.mapc[e][t]==this.NODE_OPEN?(this.updateOpenTable(e,t,n,r,i),!0):(Game.error("should never print!"),!1)},putClosedTabe:function(e,t){if(e.x==t.x&&e.y==t.y){this.findFalg=!0;return}this.OpenList[1]=this.OpenList[this.olength],this.OpenList[this.olength--]=null;var n=1,r=this.OpenList[n];for(var i=1;i<this.olength;i++)r.f>this.OpenList[i].f&&(r=this.OpenList[i],n=i);this.OpenList[n]=this.OpenList[1],this.OpenList[1]=r,this.mapc[e.x][e.y]=this.NODE_CLOSED},putOpenTable:function(e,t,n,r,i){var s=this.createNode(e,t,this.map,r);return this.count(s,n,i),this.OpenList[++this.olength]=s,this.OpenTable[s.x+"_"+s.y]=s,!0},updateOpenTable:function(e,t,n,r,i){var s=this.OpenTable[e+"_"+t],o=r.g+i;return o<s.g?(s.parent=r,this.count(s,n,i),!0):!1},count:function(e,t,n){this.countG(e,e.parent,n),this.countH(e,t),this.countF(e)},countG:function(e,t,n){t==null?e.g=n:e.g=t.g+n},countH:function(e,t){e.h=Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},countF:function(e){e.f=e.g+e.h}}),Game.ui.Container=Game.extend({calc:0,rate:1,frame:0,width:0,height:0,lastFrame:0,showFPS:!0,animateItems:{},fullScreen:!1,className:"Game.ui.Container",changeScene:function(e){var t=this.scene;this.scene=e,e.changed=!0,t&&t.hide()},drawContainer:function(){window.container.scene.drawScene(window.container.ctx),window.container.animate(),setTimeout(window.container.drawContainer,window.drawContainerInterval)},animate:function(){var e=this.animateItems;for(var t in e){var n=e[t];n.doAnimate&&n.doAnimate()}this.calc++},initContainer:function(e,t){t!=null&&(this.fullScreen=t),this.canvas=e,this.ctx=e.getContext("2d"),this.ctx.textBaseline="top",this.task=Game.getCmp("timer-container-draw"),this.initBox(e),this.onInitContainer(),Game.getCmp("eventFire-1").onEvent(this)},initBox:function(e){this.height=document.body.scrollHeight,this.fullScreen?(this.width=document.body.scrollWidth,this.xrate=this.width/960,this.yrate=this.height/640):(this.height<640&&(this.height=640),this.yrate=this.height/640,this.xrate=this.yrate,this.width=960*this.yrate),this.canvas.height=this.height,this.canvas.width=this.width,e.style["margin-left"]=-this.width/2+"px"},onInitContainer:function(){},addAnimateItem:function(e){this.animateItems[e.id]=e},removeAnimateItem:function(e){delete this.animateItems[e.id]},calcFrame:function(){var e=Date.now(),t=e-this.lastFrameTime;this.frame=parseInt(1e3/t),this.lastFrameTime=e},renderFrame:function(e){this.showFPS&&(e.textAlign="left",e.textBaseline="top",e.font="16px sans-serif",e.fillStyle="rgb(20,20,20)",e.fillText("FPS:"+this.lastFrame,5,1))},calcFPS:function(){window.container.lastFrame=window.container.frame,window.container.frame=0,window.container.scene.changed=!0,setTimeout(window.container.calcFPS,1e3)},startPlay:function(e){e||(e=30),window.drawContainerInterval=e,this.drawContainer(),this.showFPS&&this.calcFPS()}}),Game.reg("container",Game.ui.Container),Game.ui.Scene=Game.extend({levelItems:[],changed:!1,destroyItems:{},clickAbleIndex:[],clickAbleItems:[],mousemoveAbleIndex:[],mousemoveAbleItems:[],className:"Game.ui.Scene",addClickAbleItem:function(e){this.clickAbleItems[e.level]||(this.clickAbleItems[e.level]={}),this.clickAbleItems[e.level][e.id]=e;var t=!1;for(var n in this.clickAbleIndex)if(this.clickAbleIndex[n]==e.level){t=!0;break}t||(this.clickAbleIndex.push(e.level),this.clickAbleIndex.sort())},removeClickAbleItem:function(e){this.clickAbleItems[e.level]&&(delete this.clickAbleItems[e.level][e.id],this.clickAbleItems[e.level].length==0&&(delete this.clickAbleItems[e.level],this.clickAbleItems.sort(),this.clickAbleItems.length-=1))},addMousemoveAbleItem:function(e){this.mousemoveAbleItems[e.level]||(this.mousemoveAbleItems[e.level]={}),this.mousemoveAbleItems[e.level][e.id]=e;var t=!1;for(var n in this.mousemoveAbleIndex)if(this.mousemoveAbleIndex[n]==e.level){t=!0;break}t||(this.mousemoveAbleIndex.push(e.level),this.mousemoveAbleIndex.sort())},removeMousemoveAbleItem:function(e){this.mousemoveAbleItems[e.level]&&(delete this.mousemoveAbleItems[e.level][e.id],this.mousemoveAbleItems[e.level].length==0&&(delete this.mousemoveAbleItems[e.level],this.mousemoveAbleItems.sort(),this.mousemoveAbleItems.length-=1))},drawScene:function(e){if(this.changed){e.clearRect(0,0,this.width,this.height);var t=this.levelItems;for(var n in t){var r=t[n];for(n in r)r[n].render(e)}this.changed=!1,this.container.renderFrame(e)}this.container.frame++},destroy:function(){this.eventFire.destroy();var e=this.destroyItems;for(var t in e)e[t]&&(e[t].destroy(),delete e[t]);var n=this.levelItems;for(var t in n)if(n[t]){var r=n[t];for(var i in r)r[i].destroy(),delete r[i];r.length=0}n.length=0,this.superCall("destroy",this)},addDestroyItem:function(e){this.destroyItems[e.id]=e},changeEventHandle:function(e){e.scene=this,this.eventFire.eventHandle=e},init:function(){this.beforeInit(),this.container||(this.container=window.container),this.ctx=this.container.ctx,this.height=this.container.height,this.width=this.container.width,this.xrate=this.container.xrate,this.yrate=this.container.yrate,this.eventFire=Game.getCmp("eventFire-1"),this.createScene(),this.onInit()},beforeShow:function(){},onShow:function(){},show:function(){this.beforeShow(),this.container.changeScene(this),this.changeEventHandle(Game.getCmp("defaultEventHandle-1")),this.onShow()},hide:function(){this.onHide()},createScene:function(){},onHide:function(){},addLevelItem:function(e){var t=this.levelItems[e.level];t||(this.levelItems[e.level]=t={}),t[e.id]=e,this.onAddLevelItem(e)},removeLevelItem:function(e){var t=this.levelItems[e.level];t&&(e.scene.changed=!0,delete this.levelItems[e.level][e.id]),this.onRemoveLevelItem(e)},onAddLevelItem:function(e){},onRemoveLevelItem:function(e){},onDestroy:function(){},click:function(e,t,n){this.onClick(e,t,n)},onClick:function(e,t,n){},mousemove:function(e,t,n){this.onMousemove(e,t,n)},onMousemove:function(e,t,n){}}),Game.reg("scene",Game.ui.Scene),Game.util.EventFire=Game.extend({className:"Game.util.EventFire",onEvent:function(e){var t=this;e.canvas.onclick=function(e){t.eventHandle.fireEvent("click",e)},e.canvas.onmousemove=function(e){t.eventHandle.fireEvent("mousemove",e)},e.canvas.oncontextmenu=function(e){var t=1;return!1}}}),Game.reg("eventFire",Game.util.EventFire),Game.util.EventHandle=Game.extend({click:function(){},mousemove:function(){},className:"Game.util.EventHandle",fireEvent:function(e,t){switch(e){case"click":this.click(t,t.offsetX,t.offsetY);break;case"mousemove":this.mousemove(t,t.offsetX,t.offsetY);break;default:Game.log("unknow event:"+e)}}}),Game.reg("eventHandle",Game.util.EventHandle),Game.util.DefaultEventHandle=Game.extend(Game.util.EventHandle,{className:"Game.util.DefaultEventHandle",click:function(e,t,n){Game.log("Start:"+Date.now());var r=this.scene.clickAbleIndex,i=this.scene.clickAbleItems;for(var s=r.length-1;s>-1;s--){var o=i[r[s]];for(var u in o){var a=o[u];if(t>a.bx&&t<a.ex&&n>a.by&&n<a.ey){a.click(e,t,n);return}}}this.scene.click(e,t,n)},mousemove:function(e,t,n){var r=this.scene.mousemoveAbleIndex,i=this.scene.mousemoveAbleItems;for(var s=r.length-1;s>-1;s--){var o=i[s];for(var u in o){var a=o[u];if(t>a.bx&&t<a.ex&&n>a.by&&n<a.ey){a.mousemove(e,t,n);return}}}this.scene.mousemove(e,t,n)}}),Game.reg("defaultEventHandle",Game.util.DefaultEventHandle),Game.util.DialogBlankEventHandle=Game.extend(Game.util.EventHandle,{className:"Game.util.DialogBlankEventFire",click:function(e,t,n){},mousemove:function(e,t,n){}}),Game.reg("dialogBlankEventHandle",Game.util.DialogBlankEventHandle),Game.util.SourceLoader=Game.extend({itemSize:0,progress:0,loadIndex:0,itemArray:[],currentInitSize:0,className:"Game.util.SourceLoader",load:function(){if(this.itemSize==this.currentInitSize){for(var e=0;e<this.currentInitSize;e++)this.itemArray[e].doLoad(),delete this.itemArray[e];this.itemArray.length=0,this.currentInitSize=0,this.itemSize=0,this.onLoad()}else this.progress=parseInt(this.currentInitSize/this.itemSize*100)},onLoad:function(){},addItem:function(e){e.loader=this,e.initSource(),this.onAddItem(e)},onAddItem:function(e){},addLoadedItem:function(e){this.itemArray[this.currentInitSize++]=e,this.load()}}),Game.reg("sourceLoader",Game.util.SourceLoader),Game.util.Source=Game.extend({cache:!0,loaded:!1,onLoad:function(){},className:"Game.util.Source",initSource:function(){this.create();var e=this;this.dom.onload=function(){e.loaded=!0,e.loader.addLoadedItem(e)}},create:function(){},doLoad:function(){this.onLoad()}}),Game.reg("source",Game.util.Source),Game.util.Javascript=Game.extend(Game.util.Source,{className:"Game.util.Javascript",create:function(){this.dom=document.createElement("script"),this.dom.src=this.src+(this.cache?"":"?r="+Date.now()),this.dom.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(this.dom)},onLoad:function(){}}),Game.reg("js",Game.util.Javascript),Game.ui.Image=Game.extend(Game.util.Source,{cache:!1,className:"Game.ui.Image",create:function(){this.dom=new Image,this.dom.src=this.src+(this.cache?"":"?r="+Date.now())},doLoad:function(){this.width=this.dom.naturalWidth,this.height=this.dom.naturalHeight,this.onLoad()},getImgDom:function(){return this.dom}}),Game.reg("image",Game.ui.Image),Game.ui.DrawAble=Game.extend({x:0,y:0,bx:0,by:0,ex:0,ey:0,rate:1,level:1,showed:!1,clickLevel:1,autoShow:!1,clickAble:!1,mousemoveLevel:1,mousemoveAble:!1,className:"Game.ui.DrawAble",click:function(e,t,n){this.onClick(e,t,n)},onClick:function(e,t,n){},mousemove:function(e,t,n){this.onMousemove(e,t,n)},onMousemove:function(e,t,n){},hide:function(){this.showed=!1,this.scene.removeLevelItem(this),this.clickAble&&this.scene.removeClickAbleItem(this),this.mousemoveAble&&this.scene.removeMousemoveAbleItem(this),this.onHide()},onHide:function(){},show:function(e){return e&&(this.showed&&(this.showed=e==this.scene),this.scene=e),this.showed||(this.beforeShow(),this.ex=this.bx+this.renderWidth,this.ey=this.by+this.renderHeight,this.scene.addLevelItem(this),this.scene.container.addAnimateItem(this),this.autoAnimate&&this.startAnimate(),this.clickAble&&this.scene.addClickAbleItem(this),this.mousemoveAble&&this.scene.addMousemoveAbleItem(this),this.scene.changed=!0,this.showed=!0,this.onShow()),this},beforeShow:function(){},onShow:function(){},destroy:function(){this.scene.removeLevelItem(this),this.scene.container.removeAnimateItem(this),this.clickAble&&this.scene.removeClickAbleItem(this),this.mousemoveAble&&this.scene.removeClickAbleItem(this),this.superCall("destroy",this)}}),Game.reg("drawAble",Game.ui.DrawAble),Game.ui.AnimateAble=Game.extend(Game.ui.DrawAble,{moveAble:!0,showAnimate:!1,_showAnimate:!1,className:"Game.ui.AnimateAble",doAnimate:function(){if(this.showAnimate){var e=null;this.pauseTime?e=this.pauseTime:e=Date.now();var t=e-this.lastPast;if(t>=this.per){var n=t%this.per,r=(t-n)/this.per;for(var i=0;i<r;i++)this.animate();this.changeEpos(),this.scene.changed=!0,this.lastPast=e-n}else if(t/this.per>.85){var n=this.per-t;this.animate(),this.changeEpos(),this.scene.changed=!0,this.lastPast=e+n}}},beforeAnimate:function(){},animate:function(){this.beforeAnimate(),this.onAnimate()},changeEpos:function(){this.ex=this.bx+this.renderWidth,this.ey=this.by+this.renderHeight},onAnimate:function(){},onStopAnimate:function(){},startAnimate:function(){this.started||(this.showAnimate=!0,this._showAnimate=!0,this.lastPast=Date.now(),this.paused=!1,this.started=!0)},stopAnimate:function(){this.beforeStopAnimate(),this.showAnimate=!1,this._showAnimate=!1,this.started=!1,this.onStopAnimate()},beforeStopAnimate:function(){},pause:function(){this.paused||(this.pauseTime=Date.now(),this.showAnimate=!1,this.paused=!0)},play:function(){this.showAnimate=this._showAnimate,this.paused=!1},render:function(e){}}),Game.reg("animateAble",Game.ui.AnimateAble),Game.ui.MixImage=Game.extend(Game.ui.AnimateAble,{flash:!0,imgInterval:0,autoShow:!1,calcRated:!1,currentImgIndex:0,currentImgInterval:0,className:"Game.ui.MixImage",convertImgLocation:function(){var e=this.xrate*this.scene.xrate,t=this.yrate*this.scene.yrate;for(var n in this.images){var r=this.images[n];r.offsetX||(r.offsetX=0),r.offsetY||(r.offsetY=0),r.offsetX=r.offsetX*e,r.offsetY=r.offsetY*t,r.renderWidth=r.frameWidth*e,r.renderHeight=r.frameHeight*t,r.bx=this.x+r.offsetX,r.by=this.y+r.offsetY}},init:function(){this.beforeInit(),this.xrate||(this.xrate=this.rate),this.yrate||(this.yrate=this.rate),this.x=this.x*this.scene.xrate,this.y=this.y*this.scene.yrate,this.convertImgLocation(),this.img=this.images[this.currentImgIndex++],this.bx=this.images[0].bx,this.by=this.images[0].by;if(this.images.length<2)throw"please use ImageHolder";this.onInit();if(!this.imgDom)throw"none image dom found!"},animate:function(){this.beforeAnimate(),this.flash&&(this.imgInterval==0?(this.img=this.images[this.currentImgIndex++],this.calcBXBY(),this.currentImgIndex==this.images.length&&(this.currentImgIndex=0)):(this.currentImgInterval++,this.currentImgInterval==this.imgInterval&&(this.currentImgInterval=0,this.img=this.images[this.currentImgIndex++],this.calcBXBY(),this.currentImgIndex==this.images.length&&(this.currentImgIndex=0)))),this.onAnimate()},beforeStopAnimate:function(){this.img=this.images[0],this.calcBXBY()},beforeRender:function(e){},render:function(e){this.beforeRender(e),e.drawImage(this.imgDom,this.img.frameX,this.img.frameY,this.img.frameWidth,this.img.frameHeight,this.bx,this.by,this.img.renderWidth,this.img.renderHeight),this.onRender(e)},onRender:function(e){},calcBXBY:function(){this.moveAble?(this.bx=this.x+this.img.offsetX,this.by=this.y+this.img.offsetX):(this.bx=this.img.bx,this.by=this.img.by),this.renderWidth=this.img.renderWidth,this.renderHeight=this.img.renderHeight}}),Game.reg("mixImage",Game.ui.MixImage),Game.ui.ImageHolder=Game.extend(Game.ui.AnimateAble,{frameX:0,frameY:0,offsetX:0,offsetY:0,currentImgInterval:0,className:"Game.ui.ImageHolder",init:function(){this.beforeInit(),this.xrate||(this.xrate=this.rate),this.yrate||(this.yrate=this.rate),this.frameWidth||(this.frameWidth=this.img.width),this.frameHeight||(this.frameHeight=this.img.height),this.x=this.x*this.scene.xrate,this.y=this.y*this.scene.yrate,this.offsetX=this.offsetX*this.xrate*this.scene.xrate,this.offsetY=this.offsetY*this.yrate*this.scene.yrate,this.renderWidth=this.frameWidth*this.xrate*this.scene.xrate,this.renderHeight=this.frameHeight*this.yrate*this.scene.yrate,this.bx=this.x+this.offsetX,this.by=this.y+this.offsetY,this.onInit(),this.imgDom=this.img.dom,this.autoShow&&this.show()},beforeRender:function(e){},render:function(e){this.beforeRender(e),e.drawImage(this.imgDom,this.frameX,this.frameY,this.frameWidth,this.frameHeight,this.bx,this.by,this.renderWidth,this.renderHeight),this.onRender(e)},onRender:function(e){},animate:function(){this.beforeAnimate(),this.calcBXBY(),this.onAnimate()},calcBXBY:function(){this.moveAble&&(this.bx=this.x+this.offsetX,this.by=this.y+this.offsetY)}}),Game.reg("imageHolder",Game.ui.ImageHolder),Game.ui.MsgBox=Game.extend(Game.ui.ImageHolder,{level:5,dialog:!0,init:function(){this.beforeInit(),this.xrate||(this.xrate=this.rate),this.yrate||(this.yrate=this.rate),this.frameWidth||(this.frameWidth=this.img.width),this.frameHeight||(this.frameHeight=this.img.height),this.renderWidth=this.frameWidth*this.xrate*this.scene.xrate,this.renderHeight=this.frameHeight*this.yrate*this.scene.yrate,this.x==0&&(this.x=(960-this.frameWidth*this.xrate)/2),this.y==0&&(this.y=(640-this.frameHeight*this.yrate)/3),this.x=this.x*this.scene.xrate,this.y=this.y*this.scene.yrate,this.offsetX=this.offsetX*this.xrate*this.scene.xrate,this.offsetY=this.offsetY*this.yrate*this.scene.yrate,this.bx=this.x+this.offsetX,this.by=this.y+this.offsetY,this.dialogBg=Game.getCmp("dialogBg-1"),this.onInit(),this.imgDom=this.img.dom,this.autoShow&&this.show()},hide:function(){this.superCall("hide",this),this.dialogBg.hide(),this.onHide()},show:function(e){this.superCall("show",this,e),this.dialogBg.show(this.scene),this.onShow()}}),Game.reg("msgBox",Game.ui.MsgBox),Game.ui.DialogBg=Game.extend(Game.ui.DrawAble,{level:4,clickAble:!0,backgroundColor:"rgba(255, 255, 255, 0.3)",render:function(e){e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.scene.width,this.scene.height)},beforeShow:function(){this.renderWidth=this.scene.width,this.renderHeight=this.scene.height},onClick:function(e,t,n){Game.log(t+","+n)}}),Game.reg("dialogBg",Game.ui.DialogBg),Game.ui.Text=Game.extend(Game.ui.AnimateAble,{fill:!0,textAlign:"left",textBaseline:"top",font:"20px sans-serif",className:"Game.ui.Text",fillStyle:"rgba(20,20,20,1)",strokeStyle:"rgba(20,20,20,1)",className:"Game.ui.Text",render:function(e){e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.font=this.font,this.fill?(e.fillStyle=this.fillStyle,e.fillText(this.text,this.bx,this.by)):(e.strokeStyle=this.stokeStyle,e.strokeText(this.text,this.bx,this.by))},beforeShow:function(){var e=parseInt(this.font);this.renderHeight=e,this.renderWidth=e*this.text.length/2},init:function(){this.beforeInit(),this.bx=this.x=this.x*this.scene.xrate,this.by=this.y=this.y*this.scene.yrate,this.onInit(),this.autoShow&&this.show()}}),Game.reg("text",Game.ui.Text),Game.ui.Loading=Game.extend(Game.ui.AnimateAble,{per:96,level:3,circleNum:8,showAnimate:!0,autoAnimate:!0,_showAnimate:!0,progressTextAlign:"center",progressFont:"10px sans-serif",progressFillStyle:"rgb(20,20,20)",backgroundColor:"rgba(255, 255, 255, 0.5)",className:"Game.ui.Loading",beforeRender:function(e){e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.scene.width,this.scene.height)},beforeShow:function(){this.onStopAnimate()},onHide:function(){this.scene.container.removeAnimateItem(this)},renderProgress:function(e){e.fillStyle=this.progressFillStyle,e.textAlign=this.progressTextAlign,e.font=this.progressFont,e.textBaseline="middle",e.fillText(this.scene.container.loader.progress+"%",0,0)},render:function(e){this.beforeRender(e),e.translate(this.transWidth,this.transHeight),this.renderProgress(e);var t=this.rotate,n=this.maxRotate,r=this.rotateRate;for(var i=0;i<this.circleNum;i++)e.save(),this.setFillStyle(e,i),e.rotate(t*Math.PI/180),t==n?t=0:t+=r,e.beginPath(),this.arc(e,i),e.fill(),e.restore();e.translate(-this.transWidth,-this.transHeight),this.onRender(e)},onRender:function(){},onAnimate:function(){this.rotate==this.maxRotate?this.rotate=0:this.rotate+=this.rotateRate},onStopAnimate:function(){this.transWidth=this.scene.width/2,this.transHeight=this.scene.height/2,this.rotate=0,this.rotateRate=360/this.circleNum,this.maxRotate=360-this.rotateRate},onDestroy:function(){this.stopAnimate(),this.hide()}}),Game.reg("loading",Game.ui.Loading),Game.ui.BasicLoading=Game.extend(Game.ui.Loading,{className:"Game.ui.BasicLoading",setFillStyle:function(e,t){e.fillStyle="rgb("+(255-30*t)+",255,"+(247+t)+")"},arc:function(e,t){e.arc(0,35,4+t*.5,0,Math.PI*2,!0)}}),Game.reg("basicLoading",Game.ui.BasicLoading),Game.ui.BoxBootLogoLoading=Game.extend(Game.ui.Loading,{className:"Game.ui.BoxBootLogoLoading",beforeRender:function(e){e.fillStyle="rgba(0, 0, 0, 1)",e.fillRect(0,0,this.scene.width,this.scene.height),this.img.render(e)},setFillStyle:function(e,t){e.fillStyle="rgb("+(255-5*t)+",255,"+(247+t)+")"},arc:function(e,t){e.arc(0,20,1+t*.3,0,Math.PI*2,!0)},onStopAnimate:function(){this.transWidth=this.scene.width/2,this.transHeight=this.img.by+this.img.renderHeight+30,this.rotate=0,this.rotateRate=360/this.circleNum,this.maxRotate=360-this.rotateRate}}),Game.reg("boxBootLogoLoading",Game.ui.BoxBootLogoLoading),Game.ui.AlphaShow=Game.extend(Game.ui.AnimateAble,{cut:5,per:50,alpha:1,level:2,_alpha:100,rgb:"0, 0, 0",className:"Game.ui.AlphaShow",render:function(e){e.fillStyle="rgba("+this.rgb+", "+this.alpha+")",e.fillRect(0,0,this.scene.width,this.scene.height)},onAnimate:function(){this.alpha<0?this.stopAnimate():(this.alpha=(this._alpha-=this.cut)/100,this.scene.changed=!0)},stopAnimate:function(){this.hide(),this.destroy()},beforeShow:function(){this.startAnimate()}}),Game.reg("alphaShow",Game.ui.AlphaShow),Game.ui.Background=Game.extend(Game.ui.ImageHolder,{level:0,className:"Game.ui.Background",init:function(){this.beforeInit(),this.frameWidth=this.img.width,this.frameHeight=this.img.height,this.renderWidth=this.scene.width,this.renderHeight=this.scene.height,this.onInit(),this.imgDom=this.img.dom,this.autoShow&&this.show()}}),Game.reg("bg",Game.ui.Background),Game.ui.PopLogo=Game.extend(Game.ui.ImageHolder,{rate:.7,className:"Game.ui.PopLogo",init:function(e){this.beforeInit(),this.xrate||(this.xrate=this.rate),this.yrate||(this.yrate=this.rate),this.frameWidth||(this.frameWidth=this.img.width),this.frameHeight||(this.frameHeight=this.img.height),this.renderWidth=this.frameWidth*this.xrate*this.scene.xrate,this.renderHeight=this.frameHeight*this.yrate*this.scene.yrate,this.x==0&&(this.x=(960-this.frameWidth*this.xrate)/2),this.y==0&&(this.y=(640-this.frameHeight*this.yrate)/3),this.x=this.x*this.scene.xrate,this.y=this.y*this.scene.yrate,this.offsetX=this.offsetX*this.xrate*this.scene.xrate,this.offsetY=this.offsetY*this.yrate*this.scene.yrate,this.bx=this.x+this.offsetX,this.by=this.y+this.offsetY,this.dialogBg=Game.getCmp("dialogBg-1"),this.onInit(),this.imgDom=this.img.dom,this.autoShow&&this.show()}}),Game.reg("popLogo",Game.ui.PopLogo),Game.create("sourceLoader",{id:"sourceLoader-1",itemSize:1}),Game.create("defaultEventHandle",{id:"defaultEventHandle-1"}),window.container=Game.create("container",{loader:Game.getCmp("sourceLoader-1")}),Game.create("eventFire",{id:"eventFire-1"}),Game.create("dialogBg",{id:"dialogBg-1"}),Game.create("boxBootLogoLoading",{id:"box-boot-loading-1",showAnimate:!0,progressFillStyle:"rgb(255,255,255)"}),Game.create("basicLoading",{id:"basicLoading-1"}),Game.create("dialogBlankEventHandle",{id:"dialogBlankEventHandle-1"}),window.onresize=function(){}})(window.Game);