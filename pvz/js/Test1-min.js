// Licensed under the BoxBoot License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
// 
// http://www.apache.org/licenses/LICENSE-2.0
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
// ┌────────────────────────────────────────────────────────────┐ \\
// │ Test1 1.02 - JavaScript canvas Library                     │ \\
// ├────────────────────────────────────────────────────────────┤ \\
// │ Author boxboot (http://www.boxboot.com/)                   │ \\
// └────────────────────────────────────────────────────────────┘ \\
// 
// Copyright (c) 2013 BoxBoot Systems Incorporated. All rights reserved.
//
(function(Game){Game=window.Game=Game||window.Game||new function(){},Game.math=Game.math||new function(){},window.$gm=Game.math,Game.version=Game.version||"1.02";var check=function(e){return e.test(navigator.userAgent.toLowerCase())};Game.isIE=!check(/opera/)&&check(/msie/),Game.genId=Game.genId||1e3,Game.comps=Game.comps||new function(){},Game.ui=Game.ui||new function(){},Game.util=Game.util||new function(){},Game.classes=Game.classes||new function(){},Game.Object=Game.Object||function(){this.className="Game.Object"},Game.apply=function(e,t,n){if(e&&t){var r={toString:!0},i=typeof e=="function"?e.prototype:e,s=typeof t=="function"?t.prototype:t;if(n){for(var o in s)if(r[o]||!n[o])i[o]=s[o]}else for(var o in s)i[o]=s[o]}return e},Game.apply(Game,{reg:function(e,t){this.classes[e]&&this.warn("Class repeat:"+e),this.classes[e]=t,t.prototype.xtype=e},namespace:function(name){var parts=name.split("."),container=window;container[parts[0]]||eval("var "+parts[0]+" = "+parts[0]+" || new function(){};window."+parts[0]+"="+parts[0]);for(var i=0;i<parts.length;i++){var part=parts[i];if(!container[part])eval(parts.slice(0,i+1).join(".")+"="+parts.slice(0,i+1).join(".")+"|| new function(){}");else if(typeof container[part]!="object"){var n=parts.slice(0,i).join(".");throw n+" already exists and is not an object"}container=container[part]}return container},create:function(e,t){var n=new this.classes[e];if(t)for(var r in t)n[r]=t[r];if(!n.id){var i=this.getId(e);n.id=i}return this.comps[n.id],this.comps[n.id]=n,n.init&&n.init(),n},log:function(e){console.log(e)},warn:function(e){console.warn(e)},error:function(e){console.error(e)},getId:function(e){return e+"-gen-"+this.genId++},get:function(e){var t=document.getElementById(e);return t?t:this.comps[e]},getCmp:function(e){return this.comps[e]},onReady:function(e){window.onload=e},copy:function(e){if(e.className)return Game.create(e.xtype);if(this.isObject(e)){var t={};for(var n in e)t[n]=this.copy(e[n]);return t}if(this.isArray(e)){t=[];for(var n in e)t[n]=this.copy(e[n]);return t}return e},createRect:function(e,t,n){var r=[];for(var i=0;i<t;i++){r[i]=[];for(var s=0;s<e;s++)r[i][s]=n}return r}}),Game.apply(Game,{applyIf:function(e,t){if(t&&e){var n={xtype:!0,init:!0},r=typeof e=="function"?e.prototype:e,i=typeof t=="function"?t.prototype:t;for(var s in i)!n[s]&&r[s]==null&&(r[s]=i[s])}return e},isObject:function(e){return Array.isArray(e)?!1:typeof e=="object"},isArray:function(e){return Array.isArray(e)},isNull:function(e){return e==null||e==undefined}}),Game.apply(Game,{extend:function(){var _fun=" = "+function(){superc.apply(this,arguments);for(var e in son){var t=son[e];typeof t!="function"&&e!="xtype"&&(this[e]=Game.copy(t))}}.toString();return function(superc,son){if(son==null)return this.extend(this.Object,superc);if(!this.isObject(son))throw new Error("son is not a object.");var f=null;son.className?(eval(son.className+_fun),eval("f = "+son.className)):f=function(){superc.apply(this,arguments);for(var e in son){var t=son[e];typeof t!="function"&&e!="xtype"&&(this[e]=Game.copy(t))}};var tp=f.prototype=Game.copy(superc.prototype);for(var i in son){var item=son[i];typeof item=="function"&&(tp[i]=item)}return tp.superClass=superc,f}}(),override:function(e,t){if(t){var n=e.prototype;Game.apply(n,t),Game.isIE&&t.toString!=e.toString&&(n.toString=t.toString)}}}),Game.apply(Game.Object,{getId:function(){return this.id},superCall:function(e,t,n){var r=t[e],i=t.superClass.prototype[e];_o=t.superClass.prototype.superClass;while(i==r)i=_o.prototype[e],_o=_o.prototype.superClass;i.apply(t,n)},toString:function(){return(this.className?this.className:this.xtype)+"@"+this.id},onDestroy:function(){},init:function(){},destroy:function(){delete Game.comps[this.id],this.onDestroy()}}),Game.apply(Game,{setup:function(e,t){Game.getCmp("container-1").changeScene(e),e.changeEventHandle(Game.getCmp("dialogBlankEventHandle-1")),Game.getCmp("popLogo-1").scene=e,Game.getCmp("imageLoader-1").itemSize=1,Game.getCmp("imageLoader-1").addItem(Game.getCmp("popLogo-1")),Game.getCmp("imageLoader-1").onLoad=function(){Game.getCmp("box-boot-loading-1").scene=e,Game.getCmp("box-boot-loading-1").show(),Game.getCmp("timer-container-draw").start(),Game.getCmp("timer-container-renderFrame").start(),t(Game.getCmp("imageLoader-1"),e)}}}),Game.apply(Game.math,{pos:function(e,t,n){var r=e/t,i=parseInt(r),s=r-i;return n!=null&&s>n?-1:i},rotate:function(e,t){var n=Math.sqrt(e*e+t*t);return e>=0&&t>=0?Math.asin(e/n):e>=0&&t<=0?Math.acos(e/n)+Math.PI/2:e<=0&&t<=0?Math.asin(-e/n)+Math.PI:e<=0&&t>=0?Math.acos(-e/n)+Math.PI*3/2:0},distance:function(e,t,n,r){var i=n-e,s=r-t;return Math.sqrt(i*i+s*s)}}),Game.namespace("Game.math.AStar"),Game.apply(Game.math.AStar,{COST_STRAIGHT:10,COST_DIAGONAL:14,NODE_NOWAY:0,NODE_NONE:0,NODE_OPEN:1,NODE_CLOSED:2,map:null,mapc:null,width:0,height:0,OpenList:null,olength:0,findFalg:!1,OpenTable:{},className:"Game.math.AStar",reset:function(e,t,n,r,i){this.sx=e,this.sy=t,this.height=r,this.width=n,this.map=this.copyMapArea(e,t,n,r,i),this.mapc?this.resetMapc(this.NODE_NONE):this.mapc=Game.createRect(this.width,this.height,this.NODE_NONE),this.OpenList=[this.width*this.height/2],this.findFalg=!1,this.OpenTable={},this.olength=0},resetMapc:function(e){for(var t in this.mapc){var n=this.mapc[t];for(var r in n)n[r]=e}},copyMapArea:function(e,t,n,r,i){var s=[],o,u;i.length-e>r?(o=e,r=e+r):(o=i.length-r,r=i.lenght),i[0].length-t>n?(u=t,n=t+n):(u=i[0].length-n,n=i[0].lenght);var a=0,f=u;for(;o<r;o++){var l=s[a++]=[],c=0;for(;u<n;u++)l[c++]=i[o][u];u=f}return s},createNode:function(e,t,n,r){return{x:e,y:t,f:0,g:0,h:0,map:n,parent:r}},find:function(e,t,n,r){var i=this.createNode(e,t),s=this.createNode(n,r);this.olength++,this.OpenList[this.olength]=i,this.mapc[i.x][i.y]=this.NODE_OPEN;var o=null;while(this.olength>0){o=this.OpenList[1];var u=this.check(o.x,o.y+1,s,o,this.COST_STRAIGHT),a=this.check(o.x+1,o.y,s,o,this.COST_STRAIGHT),f=this.check(o.x,o.y-1,s,o,this.COST_STRAIGHT),l=this.check(o.x-1,o.y,s,o,this.COST_STRAIGHT);this.check(o.x+1,o.y+1,s,o,this.COST_DIAGONAL),this.check(o.x-1,o.y+1,s,o,this.COST_DIAGONAL),this.check(o.x+1,o.y-1,s,o,this.COST_DIAGONAL),this.check(o.x-1,o.y-1,s,o,this.COST_DIAGONAL),this.putClosedTabe(o,s);if(this.findFalg)break}if(this.findFalg){var c=[];return this.read(c,o),c}return null},read:function(e,t){t.parent!=null&&this.read(e,t.parent),e.push(t)},check:function(e,t,n,r,i){return e<0||e==this.height||t<0||t==this.width?!1:this.map[e][t]==this.NODE_NOWAY?!1:this.mapc[e][t]==this.NODE_CLOSED?!1:this.mapc[e][t]==this.NODE_NONE?(this.putOpenTable(e,t,n,r,i),this.mapc[e][t]=this.NODE_OPEN,!0):this.mapc[e][t]==this.NODE_OPEN?(this.updateOpenTable(e,t,n,r,i),!0):(Game.error("should never print!"),!1)},putClosedTabe:function(e,t){if(e.x==t.x&&e.y==t.y){this.findFalg=!0;return}this.OpenList[1]=this.OpenList[this.olength],this.OpenList[this.olength--]=null;var n=1,r=this.OpenList[n];for(var i=1;i<this.olength;i++)r.f>this.OpenList[i].f&&(r=this.OpenList[i],n=i);this.OpenList[n]=this.OpenList[1],this.OpenList[1]=r,this.mapc[e.x][e.y]=this.NODE_CLOSED},putOpenTable:function(e,t,n,r,i){var s=this.createNode(e,t,this.map,r);return this.count(s,n,i),this.OpenList[++this.olength]=s,this.OpenTable[s.x+"_"+s.y]=s,!0},updateOpenTable:function(e,t,n,r,i){var s=this.OpenTable[e+"_"+t],o=r.g+i;return o<s.g?(s.parent=r,this.count(s,n,i),!0):!1},count:function(e,t,n){this.countG(e,e.parent,n),this.countH(e,t),this.countF(e)},countG:function(e,t,n){t==null?e.g=n:e.g=t.g+n},countH:function(e,t){e.h=Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},countF:function(e){e.f=e.g+e.h}}),Game.util.Timer=Game.extend({delay:0,isStop:!0,paused:!1,lastTimeout:0,millisecond:1e3,className:"Game.util.Timer",start:function(){return this.isStop=!1,this.timeStr='Game.getCmp("'+this.id+'")._start()',this.onStart(),this._millisecond=this.millisecond,this.lastTimeout=setTimeout(this.timeStr,this.millisecond),this.lastPlay=Date.now(),this},_start:function(){this.isStop||(clearTimeout(this.lastTimeout),this.millisecond=this._millisecond,this.lastTimeout=setTimeout(this.timeStr,this.millisecond),this.lastPlay=Date.now(),this.method())},pause:function(){this.paused||(clearTimeout(this.lastTimeout),this.pauseTime=Date.now(),this.paused=!0)},play:function(){this.paused&&(this.lastPlay||(this.lastPlay=Date.now()),this.millisecond=this.millisecond-this.pauseTime+this.lastPlay,this.lastTimeout=setTimeout(this.timeStr,this.millisecond),this.lastPlay=Date.now(),this.paused=!1)},stop:function(){clearTimeout(this.lastTimeout),this.onStop(),this.isStop=!0},onStop:function(){},onStart:function(){},onDestroy:function(){this.stop(),Game.timers.remove(this.id)},init:function(){return Game.timers.put(this),this}}),Game.reg("timer",Game.util.Timer),Game.util.Map=Game.extend({_size:0,entries:{},className:"Game.util.Map",put:function(e){this.entries[e.id]=e,this._size++},get:function(e){return this.entries[e]},remove:function(e){var t=this.entries[e];return t&&(delete this.entries[e],this._size--),t},each:function(e){var t=this.entries;for(var n in t)if(e(t[n])==0)break},size:function(){return this._size},first:function(){if(this._size==0)return null;for(var e in this.entries)return this.entries[e]},clear:function(){var e=this;this.each(function(t){t.destroy(),e.remove(t)})},onDestroy:function(){this.clear()}}),Game.reg("map",Game.util.Map),Game.ui.Container=Game.extend({calc:0,rate:1,frame:0,lastFrame:0,animateItems:{},className:"Game.ui.Container",changeScene:function(e){this.task.isStop||this.task.pause(),this.scene&&this.scene.hide(),this.scene=e,this.scene.changed=!0,this.task.isStop||this.task.play()},drawContainer:function(){this.scene.drawScene(this.ctx),this.animate()},animate:function(){var e=this.animateItems;for(var t in e){var n=e[t];n.doAnimate&&n.doAnimate()}this.calc++},initContainer:function(e){return this.canvas=e,this.ctx=e.getContext("2d"),this.ctx.textBaseline="top",this.task=Game.getCmp("timer-container-draw"),this.initBox(e),this.onInitContainer(),Game.getCmp("eventFire-1").onEvent(this),this},initBox:function(e){this.height=document.body.scrollHeight,this.height<640&&(this.height=640),this.rate=this.height/640,this.width=960*this.rate,this.canvas.height=this.height,this.canvas.width=this.width,e.style["margin-left"]=-this.width/2+"px"},onInitContainer:function(){},addAnimateItem:function(e){this.animateItems[e.id]=e},removeAnimateItem:function(e){delete this.animateItems[e.id]},pause:function(){},play:function(){},calcFrame:function(){var e=Date.now(),t=e-this.lastFrameTime;this.frame=parseInt(1e3/t),this.lastFrameTime=e},renderFrame:function(e){e.textAlign="left",e.textBaseline="top",e.font="16px sans-serif",e.fillStyle="rgb(20,20,20)",e.fillText("FPS:"+this.lastFrame,5,1)}}),Game.reg("container",Game.ui.Container),Game.ui.Scene=Game.extend({levelItems:[],changed:!1,destroyItems:{},clickAbleIndex:[],clickAbleItems:[],mousemoveAbleIndex:[],mousemoveAbleItems:[],className:"Game.ui.Scene",addClickAbleItem:function(e){this.clickAbleItems[e.level]||(this.clickAbleItems[e.level]={}),this.clickAbleItems[e.level][e.id]=e;var t=!1;for(var n in this.clickAbleIndex)if(this.clickAbleIndex[n]==e.level){t=!0;break}t||(this.clickAbleIndex.push(e.level),this.clickAbleIndex.sort())},removeClickAbleItem:function(e){this.clickAbleItems[e.level]&&(delete this.clickAbleItems[e.level][e.id],this.clickAbleItems[e.level].length==0&&(delete this.clickAbleItems[e.level],this.clickAbleItems.sort(),this.clickAbleItems.length-=1))},addMousemoveAbleItem:function(e){this.mousemoveAbleItems[e.level]||(this.mousemoveAbleItems[e.level]={}),this.mousemoveAbleItems[e.level][e.id]=e;var t=!1;for(var n in this.mousemoveAbleIndex)if(this.mousemoveAbleIndex[n]==e.level){t=!0;break}t||(this.mousemoveAbleIndex.push(e.level),this.mousemoveAbleIndex.sort())},removeMousemoveAbleItem:function(e){this.mousemoveAbleItems[e.level]&&(delete this.mousemoveAbleItems[e.level][e.id],this.mousemoveAbleItems[e.level].length==0&&(delete this.mousemoveAbleItems[e.level],this.mousemoveAbleItems.sort(),this.mousemoveAbleItems.length-=1))},drawScene:function(e){if(this.changed){e.clearRect(0,0,this.width,this.height);var t=this.levelItems;for(var n in t){var r=t[n];for(n in r)r[n].render(e)}this.changed=!1,this.container.renderFrame(e)}this.container.frame++},destroy:function(){this.eventFire.destroy();var e=this.destroyItems;for(var t in e)e[t]&&(e[t].destroy(),delete e[t]);var n=this.levelItems;for(var t in n)if(n[t]){var r=n[t];for(var i in r)r[i].destroy(),delete r[i];r.length=0}n.length=0,delete Game.comps[this.id],this.onDestroy()},addDestroyItem:function(e){this.destroyItems[e.id]=e},changeEventHandle:function(e){e.scene=this,this.eventFire.eventHandle=e},init:function(){this.container||(this.container=Game.getCmp("container-1")),this.ctx=this.container.ctx,this.height=this.container.height,this.width=this.container.width,this.rate=this.container.rate,this.eventFire=Game.getCmp("eventFire-1"),this.createScene(),this.onInit()},onInit:function(){},beforeShow:function(){},onShow:function(){},show:function(){this.beforeShow(),this.container.changeScene(this),this.changeEventHandle(Game.getCmp("defaultEventHandle-1")),this.onShow()},hide:function(){this.onHide()},createScene:function(){},onHide:function(){},addLevelItem:function(e){var t=this.levelItems[e.level];t||(this.levelItems[e.level]=t={}),t[e.id]=e,this.onAddLevelItem(e)},removeLevelItem:function(e){var t=this.levelItems[e.level];t&&(e.scene.changed=!0,delete this.levelItems[e.level][e.id]),this.onRemoveLevelItem(e)},onAddLevelItem:function(e){},onRemoveLevelItem:function(e){},onDestroy:function(){},click:function(e,t,n){this.onClick(e,t,n)},onClick:function(e,t,n){},mousemove:function(e,t,n){this.onMousemove(e,t,n)},onMousemove:function(e,t,n){}}),Game.reg("scene",Game.ui.Scene),Game.util.EventFire=Game.extend({className:"Game.util.EventFire",onEvent:function(e){var t=this;e.canvas.onclick=function(e){t.eventHandle.fireEvent("click",e)},e.canvas.onmousemove=function(e){t.eventHandle.fireEvent("mousemove",e)}}}),Game.reg("eventFire",Game.util.EventFire),Game.util.EventHandle=Game.extend({click:function(){},mousemove:function(){},className:"Game.util.EventHandle",fireEvent:function(e,t){switch(e){case"click":return this.click(t,t.offsetX,t.offsetY);case"mousemove":return this.mousemove(t,t.offsetX,t.offsetY);default:Game.log("unknow event:"+e)}}}),Game.reg("eventHandle",Game.util.EventHandle),Game.util.DefaultEventHandle=Game.extend(Game.util.EventHandle,{className:"Game.util.DefaultEventHandle",click:function(e,t,n){var r=this.scene.clickAbleIndex,i=this.scene.clickAbleItems;for(var s=r.length-1;s>-1;s--){var o=i[r[s]];for(var u in o){var a=o[u];if(t>a.x&&t<a.ex&&n>a.y&&n<a.ey){a.click(e,t,n);return}}}this.scene.click(e,t,n)},mousemove:function(e,t,n){var r=this.scene.mousemoveAbleIndex,i=this.scene.mousemoveAbleItems;for(var s=r.length-1;s>-1;s--){var o=i[s];for(var u in o){var a=o[u];if(t>a.x&&t<a.ex&&n>a.y&&n<a.ey){a.mousemove(e,t,n);return}}}this.scene.mousemove(e,t,n)}}),Game.reg("defaultEventHandle",Game.util.DefaultEventHandle),Game.util.DialogBlankEventHandle=Game.extend(Game.util.EventHandle,{className:"Game.util.DialogBlankEventFire",click:function(e,t,n){},mousemove:function(e,t,n){}}),Game.reg("dialogBlankEventHandle",Game.util.DialogBlankEventHandle),Game.util.SourceLoader=Game.extend({itemSize:0,progress:0,loadIndex:0,itemArray:[],currentInitSize:0,className:"Game.util.SourceLoader",load:function(){if(this.itemSize==this.currentInitSize){for(var e=0;e<this.currentInitSize;e++)this.itemArray[e].doLoad(),delete this.itemArray[e];this.itemArray.length=0,this.currentInitSize=0,this.itemSize=0,this.onLoad()}else this.progress=parseInt(this.currentInitSize/this.itemSize*100)},onLoad:function(){},addItem:function(e){return e.loader=this,e.initSource(),this.onAddItem(e),e},onAddItem:function(e){},addLoadedItem:function(e){this.itemArray[this.currentInitSize++]=e,this.load()}}),Game.reg("sourceLoader",Game.util.SourceLoader),Game.util.ImageLoader=Game.extend(Game.util.SourceLoader,{className:"Game.util.ImageLoader"}),Game.reg("imageLoader",Game.util.ImageLoader),Game.util.Source=Game.extend({loaded:!1,className:"Game.util.Source",load:function(){this.loader.addLoadedItem(this)},doLoad:function(){this.onLoad()},onLoad:function(){},initSource:function(){this.create();var e=this;this.dom.onload=function(){e.loaded=!0,e.load(this)}},create:function(){}}),Game.reg("source",Game.util.Source),Game.util.Javascript=Game.extend(Game.util.Source,{className:"Game.util.Javascript",cache:!0,create:function(){this.dom=document.createElement("script"),this.dom.src=this.src+(this.cache?"":"?r="+Date.now()),this.dom.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(this.dom)},onLoad:function(){}}),Game.reg("js",Game.util.Javascript),Game.ui.DrawAble=Game.extend({x:0,y:0,sx:0,sy:0,level:1,clickLevel:1,showed:!1,autoShow:!1,clickAble:!1,mousemoveLevel:1,mousemoveAble:!1,className:"Game.ui.DrawAble",click:function(e,t,n){this.onClick(e,t,n)},onClick:function(e,t,n){},mousemove:function(e,t,n){this.onMousemove(e,t,n)},onMousemove:function(e,t,n){},hide:function(){this.showed=!1,this.scene.removeLevelItem(this),this.clickAble&&this.scene.removeClickAbleItem(this),this.mousemoveAble&&this.scene.removeMousemoveAbleItem(this),this.onHide()},onHide:function(){},show:function(e){return e&&(this.showed&&(this.showed=e==this.scene),this.scene=e),this.showed||(this.beforeShow(),this.ex=this.x+this.renderWidth,this.ey=this.y+this.renderHeight,this.scene.addLevelItem(this),this.scene.container.addAnimateItem(this),this.autoAnimate&&this.startAnimate(),this.clickAble&&this.scene.addClickAbleItem(this),this.mousemoveAble&&this.scene.addMousemoveAbleItem(this),this.scene.changed=!0,this.showed=!0,this.onShow()),this},beforeShow:function(){},onShow:function(){},destroy:function(){this.scene.removeLevelItem(this),this.scene.container.removeAnimateItem(this),this.clickAble&&this.scene.removeClickAbleItem(this),this.mousemoveAble&&this.scene.removeClickAbleItem(this),delete Game.comps[this.id],this.onDestroy()}}),Game.reg("drawAble",Game.ui.DrawAble),Game.ui.AnimateAble=Game.extend(Game.ui.DrawAble,{autoShow:!1,showAnimate:!1,_showAnimate:!1,className:"Game.ui.AnimateAble",doAnimate:function(){if(this.showAnimate){var e=null;this.pauseTime?e=this.pauseTime:e=Date.now();var t=e-this.lastPast;if(t>=this.per){var n=t%this.per,r=(t-n)/this.per;for(var i=0;i<r;i++)this.animate();this.changeEpos(),this.scene.changed=!0,this.lastPast=e-n}else if(t/this.per>.85){var n=this.per-t;this.animate(),this.changeEpos(),this.scene.changed=!0,this.lastPast=e+n}}},beforeAnimate:function(){},animate:function(){this.beforeAnimate(),this.onAnimate()},changeEpos:function(){this.ex=this.x+this.renderWidth,this.ey=this.y+this.renderHeight},onAnimate:function(){},onStopAnimate:function(){},startAnimate:function(){this.started||(this.showAnimate=!0,this._showAnimate=!0,this.lastPast=Date.now(),this.paused=!1,this.started=!0)},stopAnimate:function(){this.beforeStopAnimate(),this.showAnimate=!1,this._showAnimate=!1,this.started=!1,this.onStopAnimate()},beforeStopAnimate:function(){},pause:function(){this.paused||(this.pauseTime=Date.now(),this.showAnimate=!1,this.paused=!0)},play:function(){this.showAnimate=this._showAnimate,this.paused=!1},render:function(e){}}),Game.reg("animateAble",Game.ui.AnimateAble),Game.ui.Image=Game.extend(Game.util.Source,{rotate:0,cache:!0,autoShow:!1,calcRated:!1,className:"Game.ui.Image",create:function(){this.dom=new Image,this.dom.src=this.src+(this.cache?"":"?r="+Date.now())},doLoad:function(){this.width=this.dom.naturalWidth,this.height=this.dom.naturalHeight,this.renderWidth||(this.renderWidth=this.width),this.renderHeight||(this.renderHeight=this.height),this.scene&&!this.calcRated&&(this.x=this.x*this.scene.rate,this.y=this.y*this.scene.rate,this.renderWidth=this.renderWidth*this.scene.rate,this.renderHeight=this.renderHeight*this.scene.rate,this.calcRated=!0),this.onLoad(),this.autoShow&&this.show()},render:function(e){this.beforeRender(e),e.drawImage(this.dom,this.sx,this.sy,this.width,this.height,this.x,this.y,this.renderWidth,this.renderHeight),this.onRender(e)},beforeRender:function(e){},onRender:function(e){}}),Game.ui.Image=Game.extend(Game.ui.AnimateAble,new Game.ui.Image),Game.reg("image",Game.ui.Image),Game.ui.ImageHolder=Game.extend(Game.ui.AnimateAble,{autoShow:!1,calcRated:!1,onInit:function(){},currentImgInterval:0,className:"Game.ui.ImageHolder",init:function(){this.onInit(),this.width||(this.width=this.dom.width),this.height||(this.height=this.dom.height),this.renderWidth||(this.renderWidth=this.width),this.renderHeight||(this.renderHeight=this.height),this.scene&&!this.calcRated&&(this.x=this.x*this.scene.rate,this.y=this.y*this.scene.rate,this.renderWidth=this.renderWidth*this.scene.rate,this.renderHeight=this.renderHeight*this.scene.rate,this.calcRated=!0),this.autoShow&&this.show()},beforeRender:function(e){},render:function(e){this.beforeRender(e),e.drawImage(this.dom.dom,this.sx,this.sy,this.width,this.height,this.x,this.y,this.renderWidth,this.renderHeight),this.onRender(e)},onRender:function(e){}}),Game.reg("imageHolder",Game.ui.ImageHolder),Game.ui.MsgBox=Game.extend(Game.ui.ImageHolder,{level:5,dialog:!0,init:function(){this.onInit(),this.width||(this.width=this.dom.width),this.height||(this.height=this.dom.height),this.renderWidth||(this.renderWidth=this.width),this.renderHeight||(this.renderHeight=this.height),this.x==0&&(this.x=(960-this.renderWidth)/2),this.y==0&&(this.y=(640-this.renderHeight)/2),this.scene&&!this.calcRated&&(this.x=this.x*this.scene.rate,this.y=this.y*this.scene.rate,this.renderWidth=this.renderWidth*this.scene.rate,this.renderHeight=this.renderHeight*this.scene.rate,this.calcRated=!0),this.dialogBg=Game.getCmp("dialogBg-1"),this.autoShow&&this.show()},hide:function(){this.superCall("hide",this),this.dialogBg.hide()},show:function(e){this.superCall("show",this,e),this.dialogBg.show(this.scene)}}),Game.reg("msgBox",Game.ui.MsgBox),Game.ui.MultiImage=Game.extend(Game.ui.AnimateAble,{flash:!0,imgInterval:0,autoShow:!1,calcRated:!1,currentImgIndex:0,onInit:function(){},currentImgInterval:0,className:"Game.ui.MultiImage",init:function(){this.dom=this.images[this.currentImgIndex++],this.images.length==1&&(this.flash=!1,this.currentImgIndex=0),this.width||(this.width=this.dom.width),this.height||(this.height=this.dom.height),this.renderWidth||(this.renderWidth=this.width),this.renderHeight||(this.renderHeight=this.height),this.scene&&!this.calcRated&&(this.x=this.x*this.scene.rate,this.y=this.y*this.scene.rate,this.renderWidth=this.renderWidth*this.scene.rate,this.renderHeight=this.renderHeight*this.scene.rate,this.calcRated=!0),this.onInit(),this.autoShow&&this.show()},animate:function(){this.beforeAnimate(),this.flash&&(this.imgInterval==0?(this.dom=this.images[this.currentImgIndex++],this.currentImgIndex==this.images.length&&(this.currentImgIndex=0)):(this.currentImgInterval++,this.currentImgInterval==this.imgInterval&&(this.currentImgInterval=0,this.dom=this.images[this.currentImgIndex++],this.currentImgIndex==this.images.length&&(this.currentImgIndex=0)))),this.onAnimate()},beforeStopAnimate:function(){this.dom=this.images[0]},beforeRender:function(e){},render:function(e){this.beforeRender(e),e.drawImage(this.dom.dom,this.sx,this.sy,this.width,this.height,this.x,this.y,this.renderWidth,this.renderHeight),this.onRender(e)},onRender:function(e){}}),Game.reg("multiImage",Game.ui.MultiImage),Game.ui.MixImage=Game.extend(Game.ui.AnimateAble,{flash:!0,imgInterval:0,autoShow:!1,calcRated:!1,currentImgIndex:0,onInit:function(){},currentImgInterval:0,className:"Game.ui.MixImage",init:function(){this.img=this.images[this.currentImgIndex++],this.images.length==1&&(this.flash=!1,this.currentImgIndex=0),this.renderWidth||(this.renderWidth=this.img.width),this.renderHeight||(this.renderHeight=this.img.height),this.scene&&!this.calcRated&&(this.x=this.x*this.scene.rate,this.y=this.y*this.scene.rate,this.renderWidth=this.renderWidth*this.scene.rate,this.renderHeight=this.renderHeight*this.scene.rate,this.calcRated=!0),this.onInit()},animate:function(){this.beforeAnimate(),this.flash&&(this.imgInterval==0?(this.img=this.images[this.currentImgIndex++],this.currentImgIndex==this.images.length&&(this.currentImgIndex=0)):(this.currentImgInterval++,this.currentImgInterval==this.imgInterval&&(this.currentImgInterval=0,this.img=this.images[this.currentImgIndex++],this.currentImgIndex==this.images.length&&(this.currentImgIndex=0)))),this.onAnimate()},beforeStopAnimate:function(){this.img=this.images[0]},beforeRender:function(e){},render:function(e){this.beforeRender(e),e.drawImage(this.dom.dom,this.img.sx,this.img.sy,this.img.width,this.img.height,this.x,this.y,this.renderWidth,this.renderHeight),this.onRender(e)},onRender:function(e){}}),Game.reg("MixImage",Game.ui.MixImage),Game.ui.DialogBg=Game.extend(Game.ui.DrawAble,{level:4,clickAble:!0,backgroundColor:"rgba(255, 255, 255, 0.3)",render:function(e){e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.scene.width,this.scene.height)},beforeShow:function(){this.renderWidth=this.scene.width,this.renderHeight=this.scene.height},onClick:function(e,t,n){Game.log(t+","+n)}}),Game.reg("dialogBg",Game.ui.DialogBg),Game.ui.Text=Game.extend(Game.ui.DrawAble,{fill:!0,textAlign:"left",textBaseline:"top",font:"20px sans-serif",className:"Game.ui.Text",fillStyle:"rgba(20,20,20,1)",strokeStyle:"rgba(20,20,20,1)",className:"Game.ui.Text",render:function(e){e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.font=this.font,this.fill?(e.fillStyle=this.fillStyle,e.fillText(this.text,this.x,this.y)):(e.strokeStyle=this.stokeStyle,e.strokeText(this.text,this.x,this.y))},pause:function(){},play:function(){},beforeShow:function(){var e=parseInt(this.font);this.renderHeight=e,this.renderWidth=e*this.text.length/2}}),Game.reg("text",Game.ui.Text),Game.ui.Loading=Game.extend(Game.ui.AnimateAble,{per:96,level:3,circleNum:8,showAnimate:!0,autoAnimate:!0,_showAnimate:!0,progressTextAlign:"center",progressFont:"10px sans-serif",progressFillStyle:"rgb(20,20,20)",backgroundColor:"rgba(255, 255, 255, 0.5)",className:"Game.ui.Loading",beforeRender:function(e){e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.scene.width,this.scene.height)},beforeShow:function(){this.onStopAnimate()},onHide:function(){this.scene.container.removeAnimateItem(this)},renderProgress:function(e){e.fillStyle=this.progressFillStyle,e.textAlign=this.progressTextAlign,e.font=this.progressFont,e.textBaseline="middle",e.fillText(this.scene.container.loader.progress+"%",0,0)},render:function(e){this.beforeRender(e),e.translate(this.transWidth,this.transHeight),this.renderProgress(e);var t=this.rotate,n=this.maxRotate,r=this.rotateRate;for(var i=0;i<this.circleNum;i++)e.save(),this.setFillStyle(e,i),e.rotate(t*Math.PI/180),t==n?t=0:t+=r,e.beginPath(),this.arc(e,i),e.fill(),e.restore();e.translate(-this.transWidth,-this.transHeight),this.onRender(e)},onRender:function(){},onAnimate:function(){this.rotate==this.maxRotate?this.rotate=0:this.rotate+=this.rotateRate},onStopAnimate:function(){this.transWidth=this.scene.width/2,this.transHeight=this.scene.height/2,this.rotate=0,this.rotateRate=360/this.circleNum,this.maxRotate=360-this.rotateRate},onDestroy:function(){this.stopAnimate(),this.hide()}}),Game.reg("loading",Game.ui.Loading),Game.ui.BasicLoading=Game.extend(Game.ui.Loading,{className:"Game.ui.BasicLoading",setFillStyle:function(e,t){e.fillStyle="rgb("+(255-30*t)+",255,"+(247+t)+")"},arc:function(e,t){e.arc(0,35,4+t*.5,0,Math.PI*2,!0)}}),Game.reg("basicLoading",Game.ui.BasicLoading),Game.ui.BoxBootLogoLoading=Game.extend(Game.ui.Loading,{className:"Game.ui.BoxBootLogoLoading",beforeRender:function(e){e.fillStyle="rgba(0, 0, 0, 1)",e.fillRect(0,0,this.scene.width,this.scene.height),this.dom.render(e)},setFillStyle:function(e,t){e.fillStyle="rgb("+(255-5*t)+",255,"+(247+t)+")"},arc:function(e,t){e.arc(0,20,1+t*.3,0,Math.PI*2,!0)},onStopAnimate:function(){this.transWidth=this.scene.width/2,this.transHeight=this.dom.y+this.dom.renderHeight+10,this.rotate=0,this.rotateRate=360/this.circleNum,this.maxRotate=360-this.rotateRate}}),Game.reg("boxBootLogoLoading",Game.ui.BoxBootLogoLoading),Game.ui.AlphaShow=Game.extend(Game.ui.AnimateAble,{cut:5,per:50,alpha:1,level:2,_alpha:100,rgb:"0, 0, 0",className:"Game.ui.AlphaShow",render:function(e){e.fillStyle="rgba("+this.rgb+", "+this.alpha+")",e.fillRect(0,0,this.scene.width,this.scene.height)},onAnimate:function(){this.alpha<0?this.stopAnimate():(this.alpha=(this._alpha-=this.cut)/100,this.scene.changed=!0)},stopAnimate:function(){this.hide(),this.destroy()},beforeShow:function(){this.startAnimate()}}),Game.reg("alphaShow",Game.ui.AlphaShow),Game.ui.Background=Game.extend(Game.ui.ImageHolder,{level:0,className:"Game.ui.Background",init:function(){this.onInit(),this.width=this.dom.dom.width,this.height=this.dom.dom.height,this.renderWidth=this.scene.width,this.renderHeight=this.scene.height,this.autoShow&&this.show()}}),Game.reg("bg",Game.ui.Background),Game.ui.PopLogo=Game.extend(Game.ui.Image,{className:"Game.ui.PopLogo",renderHeight:300,renderWidth:300,onLoad:function(e){this.x=this.scene.width/2-150,this.y=this.scene.height/2-this.scene.height/10-200}}),Game.reg("popLogo",Game.ui.PopLogo),Game.timers=Game.timers||Game.create("map"),Game.create("imageLoader",{id:"imageLoader-1",itemSize:1}),Game.create("defaultEventHandle",{id:"defaultEventHandle-1"}),Game.create("container",{id:"container-1",loader:Game.getCmp("imageLoader-1")}),Game.create("timer",{millisecond:15,id:"timer-container-draw",method:function(){this.container.drawContainer()},onStart:function(){this.container.lastFrameTime=Date.now()},changeContainer:function(e){this.container=e,Game.getCmp("timer-container-renderFrame").container=e}}),Game.create("timer",{millisecond:1e3,id:"timer-container-renderFrame",method:function(){this.container.lastFrame=this.container.frame,this.container.frame=0,this.container.scene.changed=!0}}),Game.getCmp("timer-container-draw").changeContainer(Game.getCmp("container-1")),Game.create("eventFire",{id:"eventFire-1"}),Game.create("dialogBg",{id:"dialogBg-1"}),Game.create("popLogo",{autoShow:!1,src:"img/PopCap_Logo.jpg",id:"popLogo-1",cache:!0}),Game.create("boxBootLogoLoading",{id:"box-boot-loading-1",showAnimate:!0,dom:Game.getCmp("popLogo-1")}),Game.getCmp("box-boot-loading-1").progressFillStyle="rgb(255,255,255)",Game.create("basicLoading",{id:"basicLoading-1"}),Game.create("dialogBlankEventHandle",{id:"dialogBlankEventHandle-1"})})(window.Game);